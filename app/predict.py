import sys
import os
from tensorflow.keras.models import load_model
import numpy as np
from tensorflow.keras.preprocessing import image
from convert import convertToImage
import json

# arguments from the renderer
file_path = sys.argv[1]

# load h5 trained model
model_path = os.path.join(os.path.dirname(__file__)) + \
    '\\model\\incep_malimg_nou.h5'
model = load_model(model_path)

image_shape = (256, 256, 1)
json_file = open(os.path.join(os.path.dirname(__file__)) + '\\model\\classes.json')
data = json.load(json_file)
model_classes= data['classes']

# convert file to img
img_path = convertToImage(file_path)
print(img_path)

# load converted image and predict its class
file_img = image.load_img(img_path, target_size=image_shape, grayscale=True)
file_img = image.img_to_array(file_img)
file_img = np.expand_dims(file_img, axis=0)
ceva = model.predict(file_img)
class_index = int(np.where(ceva[0] == np.max(ceva[0]))[0])

print(model_classes[class_index])