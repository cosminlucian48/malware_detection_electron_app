import sys
from tensorflow.keras.models import load_model
import numpy as np
from tensorflow.keras.preprocessing import image
from tensorflow.keras.utils import save_img
import matplotlib.pyplot as plt
from convert import convertToImage

# print("Am primit: ", sys.argv[1])

file_path = sys.argv[1]
model = load_model('C:\\Users\\cbeja\\OneDrive\\Desktop\\ui\\app\\incep_malimg_nou.h5')

image_shape = (256,256,1)
model_classes=['Adialer.C',
 'Agent.FYI',
 'Allaple.A',
 'Allaple.L',
 'Alueron.gen!J',
 'Autorun.K',
 'Benign',
 'C2LOP.P',
 'C2LOP.gen!g',
 'Dialplatform.B',
 'Dontovo.A',
 'Fakerean',
 'Instantaccess',
 'Lolyda.AA1',
 'Lolyda.AA2',
 'Lolyda.AA3',
 'Lolyda.AT',
 'Malex.gen!J',
 'Obfuscator.AD',
 'Rbot!gen',
 'Skintrim.N',
 'Swizzor.gen!E',
 'Swizzor.gen!I',
 'VB.AT',
 'Wintrim.BX',
 'Yuner.A']

img_path = convertToImage(file_path)
print(img_path)

file_img = image.load_img(img_path, target_size=image_shape,grayscale=True)

file_img= image.img_to_array(file_img)
file_img = np.expand_dims(file_img, axis=0)

ceva  = model.predict(file_img)

class_index= int(np.where(ceva[0]==np.max(ceva[0]))[0])

print(model_classes[class_index])


# print()

# now = datetime.now()

# current_time = now.strftime("%H-%M-%S")
# saved_image_path = os.path.join(os.path.dirname(__file__)) + '\\computed\\'+current_time+'.jpg'
# print(saved_image_path)
# save_img(path=saved_image_path,x = file_img[0], data_format= "channels_last")



# print("2:",np.max(ceva[0]))
# print("1:",np.where(ceva[0][0]==np.max(ceva[0][0])), " cu ",np.max(ceva[0]))
# # print("2:",np.where(ceva[1][0]==np.max(ceva[1][0])), " cu ",np.max(ceva[1]))
# print("3:",ceva[0][0])
# print("4:",ceva[1][0])
# print("Itemul are clasa: ",ceva)
